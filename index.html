<!DOCTYPE html>
<html lang="en">
<head>
  <title> Organ Donation System</title>
  <style>
    body { font-family: Arial; max-width: 1200px; margin: 0 auto; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
    .nav { background: rgba(255,255,255,0.2); padding: 15px; border-radius: 15px; margin-bottom: 20px; }
    .nav button { background: none; border: 2px solid white; color: white; padding: 12px 24px; margin: 0 5px; border-radius: 25px; cursor: pointer; font-weight: bold; }
    .nav button.active, .nav button:hover { background: white; color: #667eea; }
    .page { display: none; padding: 30px; background: rgba(255,255,255,0.1); border-radius: 20px; backdrop-filter: blur(10px); }
    .page.active { display: block; }
    .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0; }
    .stat { background: rgba(255,255,255,0.2); padding: 25px; border-radius: 15px; text-align: center; }
    .stat-number { font-size: 3em; font-weight: bold; margin-bottom: 10px; }
    table { width: 100%; border-collapse: collapse; background: rgba(255,255,255,0.2); border-radius: 10px; overflow: hidden; }
    th, td { padding: 15px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.2); }
    th { background: rgba(255,255,255,0.3); }
    form { display: grid; gap: 15px; max-width: 500px; }
    input, select, button { padding: 15px; font-size: 16px; border: none; border-radius: 10px; }
    button { background: #28a745; color: white; font-weight: bold; cursor: pointer; }
    button:hover { background: #218838; }
    .score-high { background: #d4edda !important; color: #155724 !important; }
  </style>
</head>
<body>
  <div class="nav">
    <button onclick="showPage('dashboard')" class="active"> Dashboard</button>
    <button onclick="showPage('donors')"> Donors</button>
    <button onclick="showPage('recipients')"> Recipients</button>
    <button onclick="showPage('match')"> Match</button>
  </div>

  <div id="dashboard" class="page active">
    <h1 style="text-align: center; font-size: 2.5em;">  Organ Matching System</h1>
    <div class="stats">
      <div class="stat">
        <div id="donorCount" class="stat-number">0</div>
        <div>Available Donors</div>
      </div>
      <div class="stat">
        <div id="patientCount" class="stat-number">0</div>
        <div>Waiting Patients</div>
      </div>
      <div class="stat">
        <div class="stat-number" style="color: #ffd700;">READY</div>
        <div>Matching</div>
      </div>
    </div>
   <div style="text-align: center; font-size: 1.2em; opacity: 0.9;">
  <strong>Scoring:</strong> Blood compatibility + Organ type + Urgency + City + Hospital
</div>
  </div>

  <div id="donors" class="page">
    <h2>Add Donor</h2>
    <form id="donorForm">
  <label><strong>Name</strong></label>
  <input name="name" placeholder="John Doe" required>
  
  <label><strong>Blood Group</strong></label>
  <input name="blood_group" placeholder="O+" required>
  
  <label><strong>Organ Type</strong></label>
  <input name="organ_type" placeholder="Kidney" required>
  
  <label><strong>Hospital</strong></label>
  <input name="hospital" placeholder="City Hospital" required>
  
  <label><strong>City</strong></label>
  <input name="city" placeholder="Mumbai" required>
  
  <label><strong>Urgency</strong></label>
  <select name="urgency">
    <option value="1">Low</option>
    <option value="3">Medium</option>
    <option value="5">High</option>
  </select>
  
  <button type="submit"> Add Donor</button>
  </form>
    <h3 style="margin-top: 30px;">Registered Donors</h3>
    <table id="donorsTable">
      <tr><th>ID</th><th>Name</th><th>Blood</th><th>Organ</th><th>City</th></tr>
    </table>
  </div>

  <div id="recipients" class="page">
    <h2>Add Recipient</h2>
    <form id="recipientForm">
  <label><strong>Name</strong></label>
  <input name="name" placeholder="John Doe" required>
  
  <label><strong>Blood Group</strong></label>
  <input name="blood_group" placeholder="O+" required>
  
  <label><strong>Organ Type</strong></label>
  <input name="organ_type" placeholder="Kidney" required>
  
  <label><strong>Hospital</strong></label>
  <input name="hospital" placeholder="City Hospital" required>
  
  <label><strong>City</strong></label>
  <input name="city" placeholder="Mumbai" required>
  
  <label><strong>Urgency</strong></label>
  <select name="urgency">
    <option value="1">Low</option>
    <option value="3">Medium</option>
    <option value="5">High</option>
  </select>
  
  <button type="submit">Add patient</button>
  </form>
    <h3 style="margin-top: 30px;">Waiting Patients</h3>
    <table id="recipientsTable">
      <tr><th>ID</th><th>Name</th><th>Blood</th><th>Organ</th><th>City</th></tr>
    </table>
  </div>

  <div id="match" class="page">
    <h2> AI Matching Engine</h2>
    <div style="margin-bottom: 20px;">
      <select id="donorSelect" style="padding: 15px; font-size: 16px; border-radius: 10px; border: none;">
        <option>Select Donor...</option>
      </select>
      <button onclick="runMatch()" style="margin-left: 15px; padding: 15px 30px; font-size: 18px;"> Find Matches</button>
    </div>
    <h3>Top Matches (AI Ranked)</h3>
    <table id="matchesTable" style="display: none;">
      <tr><th>Score</th><th> Patient</th><th>Blood</th><th>City</th><th>Reason</th><th>Action</th></tr>
    </table>
  </div>

  <script>
    let currentPage = 'dashboard';
    
    function showPage(page) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
      document.getElementById(page).classList.add('active');
      event.target.classList.add('active');
      currentPage = page;
      
      if (page === 'donors') loadDonors();
      if (page === 'recipients') loadRecipients();
      if (page === 'match') loadDonorsForMatch();
    }
    
    async function loadDonors() {
      const res = await fetch('/api/donors');
      const donors = await res.json();
      const table = document.getElementById('donorsTable');
      table.innerHTML = '<tr><th>ID</th><th>Name</th><th>Blood</th><th>Organ</th><th>City</th></tr>';
      donors.forEach(d => {
        table.innerHTML += `<tr><td>${d.id}</td><td>${d.name}</td><td>${d.blood_group}</td><td>${d.organ_type}</td><td>${d.city}</td></tr>`;
      });
    }
    
    document.getElementById('donorForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const donor = Object.fromEntries(formData);
      donor.urgency = parseInt(donor.urgency);
      
      await fetch('/api/donors', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(donor)
      });
      e.target.reset();
      loadDonors();
      updateDashboard();
      alert(' Donor added!');
    });
    
    async function loadRecipients() {
      const res = await fetch('/api/recipients');
      const recipientsData = await res.json();
      const table = document.getElementById('recipientsTable');
      table.innerHTML = '<tr><th>ID</th><th>Name</th><th>Blood</th><th>Organ</th><th>City</th></tr>';
      recipientsData.forEach(r => {
        table.innerHTML += `<tr><td>${r.id}</td><td>${r.name}</td><td>${r.blood_group}</td><td>${r.organ_type}</td><td>${r.city}</td></tr>`;
      });
    }
    
    document.getElementById('recipientForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const recipient = Object.fromEntries(formData);
      recipient.urgency = parseInt(recipient.urgency);
      
      await fetch('/api/recipients', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(recipient)
      });
      e.target.reset();
      loadRecipients();
      updateDashboard();
      alert(' Patient added!');
    });
    
    async function loadDonorsForMatch() {
      const res = await fetch('/api/donors');
      const donors = await res.json();
      const select = document.getElementById('donorSelect');
      select.innerHTML = '<option>Select Donor...</option>';
      donors.forEach(d => {
        select.innerHTML += `<option value="${d.id}">${d.name} (${d.blood_group}, ${d.organ_type})</option>`;
      });
    }
    
    async function runMatch() {
      const donorId = document.getElementById('donorSelect').value;
      if (!donorId) return alert('Select donor first!');
      
      const res = await fetch('/api/match', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({donor_id: parseInt(donorId)})
      });
      const matches = await res.json();
      
      const table = document.getElementById('matchesTable');
      table.style.display = 'table';
      table.innerHTML = '<tr><th>Score</th><th> Patient</th><th>Blood</th><th>City</th><th>Reason</th><th>Action</th></tr>';
      
      matches.forEach(m => {
        const row = table.insertRow();
        row.innerHTML = `
          <td class="${m.score > 80 ? 'score-high' : ''}">${m.score}</td>
          <td><strong>${m.name}</strong></td>
          <td>${m.blood_group}</td>
          <td>${m.city}</td>
          <td>${m.reason}</td>
          <td><button onclick="reserve(${m.id})" style="background: #dc3545;">RESERVE</button></td>
        `;
      });
    }
    
    function reserve(id) {
      alert(` PERFECT MATCH CONFIRMED!\nPatient ${id} reserved organ!\n\n `);
    }
    
    // Dashboard stats - UPDATES AUTOMATICALLY
    async function updateDashboard() {
      try {
        const dRes = await fetch('/api/donors');
        const rRes = await fetch('/api/recipients');
        const donors = await dRes.json();
        const recipientsData = await rRes.json();
        
        document.getElementById('donorCount').textContent = donors.length;
        document.getElementById('patientCount').textContent = recipientsData.length;
      } catch(e) {}
    }
    
    // Auto-update dashboard every 2 seconds
    setInterval(updateDashboard, 2000);
    updateDashboard();
  </script>
</body>
</html>